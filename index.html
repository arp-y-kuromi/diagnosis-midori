<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      window.acs_cbs = window.acs_cbs || [];
      (function acsKeep() {
        const PK = "pid";
        const IMK = "im";
        const LKEYS = { cid: ["cid", "CL_", "ACT_"] };
        const PDIR = "./";
        const durlBase = "https://s13.aspservice.jp/in3/direct.php";
        const cookieExpiry = new Date(Date.now() + 63072000000).toUTCString();
        const args = `; expires=${cookieExpiry}; path=/; SameSite=None; Secure`;

        // クッキーとローカルストレージにデータを保存
        function saveCookies(data) {
          const p = data[PK];
          const filteredData = filterDataByKeys(data, LKEYS);

          if (!p || !Object.keys(filteredData).length) return;

          let purl = `${PDIR}lptag.php?p=${p}`;
          Object.keys(filteredData).forEach((key) => {
            purl += `&${LKEYS[key][0]}=${filteredData[key]}`;
            localStorage.setItem(`${LKEYS[key][1]}${p}`, filteredData[key]);
          });

          sendRequest(purl, () => {
            if (xhr.status === 200 && xhr.response === "") {
              executeCallbacks();
            } else {
              saveDataToCookies(filteredData, p);
              executeCallbacks();
            }
          });
        }

        // フィルタリングされたデータをクッキーに保存
        function saveDataToCookies(data, p) {
          Object.keys(data).forEach((key) => {
            document.cookie = `${LKEYS[key][1]}${p}=${decodeURIComponent(
              data[key]
            )}${args}`;
            if (LKEYS[key][2])
              document.cookie = `${LKEYS[key][2]}${p}=js${args}`;
          });
        }

        // リクエスト送信用関数
        function sendRequest(url, onLoadCallback) {
          const xhr = new XMLHttpRequest();
          xhr.open("GET", url);
          xhr.onloadend = onLoadCallback;
          xhr.send();
        }

        // キーに基づいてデータをフィルタリング
        function filterDataByKeys(data, keys) {
          return Object.keys(keys).reduce((result, key) => {
            if (data[key]) result[key] = data[key];
            return result;
          }, {});
        }

        // コールバック関数を実行
        function executeCallbacks() {
          window.acs_cbs.forEach((cb) => cb());
        }

        // クエリパラメータからデータを取得
        const data = location.search
          .substring(1)
          .split("&")
          .reduce((result, s) => {
            const [key, value] = s.split("=");
            if (value) result[key] = value;
            return result;
          }, {});

        if (!data[IMK]) {
          saveCookies(data);
          return;
        }

        // ディレクトリURLの更新
        let durl = `${durlBase}?im=${data[IMK]}&navi=${performance.navigation.type}`;
        durl += Object.keys(data)
          .filter((key) => DKEYS.includes(key))
          .map((key) => `&${key}=${data[key]}`)
          .join("");

        // データをマージして送信
        sendRequest(durl, () => {
          if (xhr.status !== 200) return;
          try {
            const xhrData = JSON.parse(xhr.responseText);
            if (PK !== "p") xhrData[PK] = xhrData["p"];
            saveCookies({ ...xhrData, ...data });
          } catch (e) {
            console.error("Failed to parse response data", e);
          }
        });
      })();
    </script>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>司法書士法人みどり法務事務所</title>
    <script type="module" crossorigin src="/assets/index-CAgdR9Te.js"></script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
